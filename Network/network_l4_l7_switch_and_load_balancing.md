# π€ L7/L4 μ¤μ„μΉ, λ΅λ“λ°Έλ°μ‹±

# π“ λ΅λ“λ°Έλ°μ‹±

### β”οΈ κ°μ”

- λ΅λ“λ°Έλ°μ„λ” μ„λΉ„μ¤μ© μ£Όμ†λ¥Ό κ°€μ§„ κ°€μƒμ„λ²„λ΅ λ™μ‘ν•λ‹¤.
- ν΄λΌμ΄μ–ΈνΈλ΅μ™€ λ‹¤μ¤‘ν™”λ κ°κ°μ μ‹¤μ μ„λ²„λ¥Ό μ¤‘κ³„ν•λ” μ—­ν•  μν–‰.

> κ°λ°μ `κΉ€λ§λ‘`μ€ μμ‹ μ μ›Ή μ„λ²„λ¥Ό κµ¬μ¶•ν•΄ μ„λΉ„μ¤λ¥Ό μ κ³µν–λ‹¤. μ–Όλ§ λ’¤ μ„λΉ„μ¤ μ‚¬μ©μκ°€ λ§μ•„μ§€κ³  μ ‘μ†λ‰κ³Ό νΈλν”½μ΄ μ¦κ°€ν•΄ κΈ°μ΅΄μ— μ΄μ©ν•λ μ„λ²„ `A(xxx.xxx.xx.1)`λ§μΌλ΅λ” μ•μ •μ μΈ μ„λΉ„μ¤λ¥Ό 
> μ κ³µν•  μ μ—†κ² λλ‹¤.  
> μ„λ²„ μμ²΄μ μ„±λ¥κ°μ„ (Scale-Up) ν›„μ—λ„ νΈλν”½μ„ κ°λ‹Ήν•  μ μ—†κ²λμ μ¶”κ°€λ΅ μ„λ²„ 2λ€`B(xxx.xxx.xx.2)`, `C(xxx.xxx.xx.3)`λ¥Ό μ¦μ„¤(Scale-Out)ν–λ‹¤.  
> μ΄ λ• κ°κ°μ μ„λ²„ urlμ„ λ°”κΏ”κ°€λ©° ν΄λΌμ΄μ–ΈνΈκ°€ μ§μ ‘ μ„λ²„ μƒνƒλ¥Ό λ³΄κ³  μ”μ²­ν•λ”κ²ƒμ΄ μ•„λ‹ `λ΅λ“λ°Έλ°μ„`μ— ν΄λΌμ΄μ–ΈνΈ μ”μ²­μ„ μ „λ‹¬ν•κ²λκ³  `λ΅λ“λ°Έλ°μ„`λ” ν•μ„ λ„¤νΈμ›ν¬μ— μ„λ²„λ΅ μ”μ²­μ„ μ „λ‹¬ν•λ‹¤.

- λ΅λ“λ°Έλ°μ„ μ±„μ© μ „ν›„ λ„¤νΈμ›ν¬ λ„μ‹μ€ λ‹¤μκ³Ό κ°™λ‹¤
- μ „)  
  <img src="./img/no_load_balancer.png" width="500px" />
- ν›„)  
  <img src="./img/load_balancer_summary.png" width="500px" />

### β”οΈ λ©μ 
- μ„λ²„ μμ› μ‚¬μ©μ μµμ ν™”
- λ°μ΄ν„° μ²λ¦¬λ‰μ μ¦κ°€
- ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„ μ‘λ‹µμ†λ„ κ°μ†
- νΉμ • μ„λ²„μ κ³Όλ¶€ν™” λ°©μ§€
- μ•μ •μ„±, κ°€μ©μ„± κ·Ήλ€ν™”

### β”οΈ μ•κ³ λ¦¬μ¦

#### μ •μ  λ¶€ν•λ¶„μ‚° Static Load Balancing

>- **Round Robin**
   >  - μ…λ ¥λ°›μ€ μ”μ²­μ„ κ°κ°μ μ„λ²„μ— μμ°¨μ μΌλ΅ ν• λ‹Ήν•λ” λ°©μ‹.
>  - ν΄λΌμ΄μ–ΈνΈμ μ”μ²­μ„ μμ„λ€λ΅ λ¶„λ°°ν•κΈ° λ•λ¬Έμ— μ•κ³ λ¦¬μ¦μ΄ λ‹¨μν•κ³  κ° μ„λ²„κ°€ νΈλν”½μ„ κ³¨κ³ λ£¨ λ‚λ μ„ μ²λ¦¬ν•λ‹¤.
>  - κ° μ„λ²„μ μ²λ¦¬λ‰μ΄ λΉ„μ·ν•  κ²½μ° μ΄μ©.  
     >  <img src="./img/round_robin_method.png" width="500px" />
>- **IP Hash**
   >  - ν΄λΌμ΄μ–ΈνΈμ IPμ£Όμ†λ¥Ό νΉμ • μ„λ²„μ— λ§¤ν•‘ν•΄ νΉμ • IPμ—μ„ μ „λ‹¬λ°›μ€ μ”μ²­μ„ ν•­μƒ λ§¤ν•‘λ μ„λ²„λ΅ λ³΄λ‚΄λ” λ°©μ‹.
>  - ν΄λΌμ΄μ–ΈνΈλ” ν•­μƒ λ™μΌν• μ„λ²„λ΅ μ ‘μ†ν•κ²λλ‹¤.  
     >  <img src="./img/ip_hash_method.png" width="500px" />
#### λ™μ  λ¶€ν•λ¶„μ‚° Dynamic Load Balancing

>- **Weighted Round Robin**
   >  - κ° μ„λ²„λ³„λ΅ κ°€μ¤‘μΉλ¥Ό μ„¤μ •ν•κ³  κ°€μ¤‘μΉκ°€ κ°€μ¥ λ†’μ€ μ„λ²„μ— νΈλν”½μ„ μ°μ„  λ°°μ •ν•λ‹¤.
>  - ν΄λΌμ΄μ–ΈνΈ μ…λ ¥μ΄ 100μ΄κ³  μ„λ²„ A, B, Cμ κ°€μ¤‘μΉκ°€ 2, 3, 5λΌκ³  κ°€μ •ν–μ„ λ• κ° μ„λ²„μ—λ” 20, 30, 50μ μ…λ ¥μ΄ Round Robin λ°©μ‹μΌλ΅ μ „λ‹¬λλ‹¤.
>  - κ° μ„λ²„μ μ²λ¦¬λ‰μ΄ μƒμ΄ν•  κ²½μ° μ΄μ©.  
     >  <img src="./img/weight_round_robin_method.png" width="500px" />
>- **Least Connection**
   >  - ν•΄λ‹Ή μ‹μ μ—μ„ μ—°κ²°λ μ”μ²­μ΄ κ°€μ¥ μ μ€ μ„λ²„λ΅ μ”μ²­μ„ λ³΄λ‚Έλ‹¤.
>  - μ„Έμ… μ μ§€μ‹κ°„μ΄ κΈΈκ±°λ‚ μ„λ²„μ— λ¶„μ‚°λ νΈλν”½μ΄ μΌμ •ν•μ§€ μ•μ€ κ²½μ° μ΄μ©.
>- **Least Response Time**
   >  - ν΄λΌμ΄μ–ΈνΈ μ”μ²­μ„ μ „λ‹¬ν•κΈ° μ „ κ° μ„λ²„μ— μ‘λ‹µμ„ μ”μ²­ν•κ³  μ‘λ‹µμ‹κ°„μ΄ κ°€μ¥ μ§§μ€ μ„λ²„μ— ν΄λΌμ΄μ–ΈνΈ μ”μ²­μ„ μ „λ‹¬ν•λ‹¤
>  - κ° μ„λ²„μ μ„±λ¥μ΄ μƒμ΄ν•  κ²½μ° μ΄μ©.
### β”οΈ λ΅λ“λ°Έλ°μ„μ μΆ…λ¥

> λ΅λ“λ°Έλ°μ‹±μ—λ” L4 λ΅λ“λ°Έλ°μ‹±κ³Ό L7 λ΅λ“λ°Έλ°μ‹±μ΄ μ‚¬μ©λλ‹¤.  
> μμ„Έν• λ‚΄μ©μ€ λ‹¤μ μ¥ `L4/L7μ¤μ„μΉ` μ°Έμ΅°

- **L4 λ΅λ“λ°Έλ°μ‹±**
    - IP, MAC, PORT λ“± OSI 7 κ³„μΈµ μ¤‘ 4κ³„μΈµ(μ „μ†΅κ³„μΈµ) μ΄ν• ν”„λ΅ν† μ½μ ν—¤λ”λ¥Ό κΈ°λ°μΌλ΅ λ¶€ν•λ¥Ό λ¶„μ‚°ν•λ‹¤.
- **L7 λ΅λ“λ°Έλ°μ‹±**
    - L4μ κΈ°λ¥ + HTTP, FTP, SMTP λ“± OSI 7 κ³„μΈµ μ¤‘ 7κ³„μΈµ(μ• ν”λ¦¬μΌ€μ΄μ…κ³„μΈµ) μ΄ν• ν”„λ΅ν† μ½ ν—¤λ”λ¥Ό κΈ°λ°μΌλ΅ λ¶€ν•λ¥Ό λ¶„μ‚°ν•λ‹¤.

### β—οΈ μ£Όμν•  μ 

- λ΅λ“λ°Έλ°μ„ λν• μΌμΆ…μ `μ¥μΉ`μ΄κΈ°λ•λ¬Έμ— λ‹¤μ¤‘ν™” λ“± μ¥μ•  λ€λΉ„μ±…μ„ λ§λ ¨ν•΄μ•Όν•λ‹¤.

## π“ L4/L7 μ¤μ„μΉ

### λ„¤νΈμ›ν¬ μ¤μ„μΉλ€?

- λ„¤νΈμ›ν¬ μ¤μ„μΉλ” ν΄λΌμ΄μ–ΈνΈλ¥Ό μ”μ²­ν• μ£Όμ†μ— λ§κ² λ©μ μ§€μ™€ μ¤‘κ³„ν•΄μ£Όλ” μ—­ν• μ„ ν•λ‹¤.
- μ΄λ” μ¤μ„μΉ λ μ΄μ–΄ λ λ²¨μ— κ΄€κ³„ μ—†μ΄ μ„λ²„μ μ‹¤μ  μ£Όμ†λ¥Ό μ¨κΈ°λ” μ—­ν• μ„ ν•λ‹¤.
- νΉν L4/L7μ¤μ„μΉλ” μ•μ„  μ¥μ—μ„ λ‹¤λ£¬ λ΅λ“λ°Έλ°μ‹±μ κΈ°λ¥μ„ μν–‰ν•λ‹¤.
- 4 ~ 7 κ³„μΈµ μ¤μ„μΉλ” ν•μ„κ³„μΈµ μ¤μ„μΉμ κΈ°λ¥μ„ ν¬ν•¨ν•λ‹¤.

### L4 μ¤μ„μΉ

- ν΄λΌμ΄μ–ΈνΈ μ”μ²­μ ν”„λ΅ν† μ½ ν—¤λ”(IP, PORT)λ¥Ό κΈ°λ°μΌλ΅ Source IPμ™€ Destination IPλ¥Ό λ³€μ΅°ν•΄ λ‹¤μ¤‘ν™”λ μ„λ²„μ™€ μ¤‘κ³„ν•΄μ£Όλ” μ—­ν• μ„ ν•κΈ°μ— IP, PORT λ¥Ό κΈ°λ°μΌλ΅ ν• λ΅λ“λ°Έλ°μ‹±μ„ μν–‰ν•λ‹¤.
- ν΄λΌμ΄μ–ΈνΈκ°€ TCP ν”„λ΅ν† μ½λ΅ μ„λ²„μ— μ ‘μ†ν•λ ¤ ν•  κ²½μ° λ©μ μ§€ μ„λ²„μ™€ `μ—°κ²° μ„±λ¦½ κ³Όμ •(3-Way HandShake)`μ„ κ±°μ³ μ»¤λ„¥μ…μ΄ μƒμ„±λλ”λ° L4μ¤μ„μΉμ—μ„λ„ μ»¤λ„¥μ… λ°μ΄ν„°λ¥Ό μƒμ„±ν•΄ κ΄€λ¦¬ν•λ‹¤.
    - μ΄λ• μ—°κ²°μ΄ μΌμ •μ‹κ°„λ™μ• μ‚¬μ©λμ§€ μ•μ„ κ²½μ° μ»¤λ„¥μ…μ„ μ‚­μ ν•λ” κ°’μ„ κ°€μ§„λ‹¤.

### L7 μ¤μ„μΉ

- μ–΄ν”λ¦¬μΌ€μ΄μ… κ³„μΈµμ—μ„ λ™μ‘ν•λ” `L7 μ¤μ„μΉ`λ” νΈλν”½ λ‚΄μ©(URI, Payload, Cookie, HTTP ν—¤λ” λ“±)μ„ μ§μ ‘ λ¶„μ„ν•  μ μμ–΄ `L4 μ¤μ„μΉ`λ³΄λ‹¤ μ •κµν• λ΅λ“λ°Έλ°μ‹±μ— μ‚¬μ©λλ‹¤.
- `L4 μ¤μ„μΉ`μ— λΉ„ν•΄ μμ›μ μ†λ¨κ°€ ν¬λ‹¤.

### L4 vs L7

#### κ³µν†µμ 

- λ„λ‹¬ν• ν¨ν‚·μ„ μ μ ν• λ©μ μ§€λ΅ λ³΄λ‚΄μ¤€λ‹¤.
- λ΅λ“λ°Έλ°μ‹±κΈ°λ¥μ„ μν–‰ν•λ‹¤.

#### μ°¨μ΄μ 

- TCP ν”„λ΅ν† μ½
    - `L4 μ¤μ„μΉ`λ” μ¤‘κ³„λ μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈκ°„ `μ—°κ²° μ„±λ¦½ κ³Όμ •(3-Way HandShake)`μ„ ν†µν•΄ ν•λ‚μ μ„Έμ…μ„ μƒμ„±ν•λ‹¤.
    - `L7 μ¤μ„μΉ`λ” ν΄λΌμ΄μ–ΈνΈμ™€ μ¤μ„μΉ, μ¤μ„μΉμ™€ μ„λ²„κ°„ `μ—°κ²° μ„±λ¦½ κ³Όμ •(3-Way HandShake)`μ„ ν†µν•΄ κ°κ°μ TCP μ„Έμ…μ„ μƒμ„±ν•λ‹¤.
- `L7 μ¤μ„μΉλ”` ν¨ν‚·, νμ΄λ΅λ“μ λ¶„μ„μ„ ν†µν•΄ `ν¨ν‚· ν•„ν„°λ§` κΈ°λ¥μ„ μν–‰ν•  μ μλ‹¤.
- Mega Proxy Problem
    - `L4 μ¤μ„μΉ`μ—μ„ `IP Hash`λ°©μ‹μΌλ΅ λ¶€ν•λ¥Ό λ¶„μ‚°ν•  κ²½μ° νΉμ • μ„λ²„μ— μ”μ²­μ΄ μ§‘μ¤‘λλ” ν„μƒμ΄ λ°μƒν•  μ μλ‹¤.

---

# β“ μμƒ μ§λ¬Έ

**Q1** λ΅λ“λ°Έλ°μ‹±μ΄λ€?
> **A1** ν•λ‚μ μ„λ²„λ΅ μ•μ •μ μΌλ΅ μ„λΉ„μ¤λ¥Ό μ κ³µν•κΈ° μ–΄λ ¤μ› Scale Out ν•  κ²½μ°
> ν΄λΌμ΄μ–ΈνΈμ—κ² λ‹¤μμ μ„λ²„ μ„ νƒμ§€λ¥Ό μ£Όλ”κ²ƒμ΄ μ•„λ‹ κΈ€λ΅λ² μ„λ²„ μ£Όμ†λ¥Ό μ κ³µν•κ³  μ”μ²­λ°›μ€ νΈλν”½μ„ μ μ ν λ¶„μ‚°ν•΄μ£Όλ” κΈ°μ μ…λ‹λ‹¤.

**Q2** L4 λ΅λ“λ°Έλ°μ‹±κ³Ό L7 λ΅λ“λ°Έλ°μ‹±μ μ¥λ‹¨μ ?
> **A2** L4 λ΅λ“λ°Έλ°μ‹±μ κ²½μ° ν¨ν‚· νμ΄λ΅λ“κΉμ§€ μ ‘κ·Όν•μ§€ μ•μ•„ μ†λ„κ°€ λΉ λ¥΄κ³  μμ› ν¨μ¨μ΄ μΆ‹μΌλ©° λΉ„μ©μ΄ μ €λ ΄ν•μ§€λ§
> μ„Έλ°€ν• λ΅λ“λ°Έλ°μ‹±μ΄ μ–΄λ µκ³  μ„λ²„μ™€μ 4κ³„μΈµ μ—°κ²°μ΄ λμ–΄μ§€μ§€ μ•λ” μ΄μƒ μ¥μ• λ¥Ό νλ‹¨ν•κΈ° μ–΄λ µμµλ‹λ‹¤.
> L7 λ΅λ“λ°Έλ°μ‹±μ κ²½μ° λΉ„μ •μƒ νΈλν”½μ„ νλ‹¨ν•  μ μκ³  μ •κµν• λ΅λ“λ°Έλ°μ‹±μ΄ κ°€λ¥ν•μ§€λ§ λΉ„μ©μ΄ ν¬κ³  μ†λ„μ™€ μμ› ν¨μ¨μ„±μ΄ κ°μ†ν•©λ‹λ‹¤.

**Q3** λ΅λ“λ°Έλ°μ‹± μ•κ³ λ¦¬μ¦ μ¤‘ λΌμ΄λ“λ΅λΉ λ°©μ‹μ μ¥λ‹¨μ ?
> **A3** ν¨ν‚·μ„ μ”μ²­λ°›μ€ κ° μ„λ²„μ— μμ„λ€λ΅ ν• λ‹Ήν•κΈ°λ•λ¬Έμ— μ•κ³ λ¦¬μ¦μ΄ κ°„λ‹¨ν•©λ‹λ‹¤.  
> ν•μ§€λ§ μ΄κ²½μ° νΉμ • μ„λ²„μ— μ¥μ• κ°€ λ°μƒν•΄ μ„±λ¥μ΄ μ €ν•λ  κ²½μ° μ²λ¦¬μ†λ„κ°€ λλ ¤μ§ κ°€λ¥μ„±μ΄ μμµλ‹λ‹¤.
---
## μ°Έκ³ μλ£
- λ΅λ“ λ°Έλ°μ‹±μ μ‘λ™ λ°©μ‹ μ΄ν•΄ : https://www.cisco.com/c/ko_kr/support/docs/ip/border-gateway-protocol-bgp/5212-46.html
- [λ„¤νΈμ›ν¬] λ΅λ“λ°Έλ°μ„μ κΈ°λ³Έ : https://etloveguitar.tistory.com/136
- λ΅λ“λ°Έλ°μ‹± (Load Balancing) : https://velog.io/@come_true/%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%8B%B1-Load-Balancing